\chapter{Алгоритм многогипотезного восстановления траектории}
\renewcommand{\headtext}{\thechapter.~Алгоритм многогипотезного восстановления траектории}

Данный раздел отчёта посвящен
исследованию задачи получения оценок параметров движения воздушного судна
по поступающим радиолокационным замерам.
В рассматриваемом подходе наряду с текущими показателями (Федотов: слово параметры нехорошо исп, изза предыдущ. предлож.) движения формируются
наиболее вероятные варианты предыстории движения
в виде модельных траекторий с заданными начальной точкой и управлениями.
Рассматривается движение в горизонтальной плоскости.
Модель движения -- система дифференциальных уравнений
4-го порядка с ограничением на продольное и боковое ускорения.

Формируемая совокупность возможных траекторий движения воздушного судна
с кусочно-постоянными управлениями используются для получения текущей
средне-взвешенной оценки текущего положения ВС.
В общем случае такая задача является многоэкстремальной, даже в случае,
когда для её решения используются замеры одного и того же воздушного судна.
Поэтому является естественным использование в качестве оценки движения ВС
нескольких вариантов траектории.

Предлагаемый подход во многом пересекается с подходом, используемым
в настоящее время при мультирадарной обработке данных в НИТА,
где задействуется фильтр Калмана и метод IMM.
В частности, как и в IMM, в каждый момент времени рассматриваются различные варианты движения.
Расчёт на улучшение показателей (по сравнению с методом IMM)
по оценке текущих параметров движения сделан в первую очередь
на дополнительно использование оценок предыстории движения.


\section{Постановка задачи}

Рассматривается движение воздушного судна в горизонтальной плоскости.
Требуется для задачи мультирадарной обработки оценить возможности
использования подхода, опирающегося на способ представления
траекторного движения воздушного судна в виде набора наиболее
вероятных движений. В качестве текущей оценки положения ВС
рассмотреть варианты выбора по "наилучшей траектории"
и выбора по средней траектории с использованием принципа
максимальной достоверности.

Формирование "пучка" траекторий должна производиться с условием
максимальной представительности вариантов движения.
Расчёты с ветвлением "пучка" и последующее прореживание
с целью ограничения общего количества вероятных треков
веполнять для каждого вновь поступившего замера.

Модель траекторного движения ВС должна соответствовать
[ссылка на ГОСТ (есть) и сборник Красова (пока не нашел)]

Провести моделирование на реальных и модельных данных.
Для обработки реальных данных выполнить преобразование
в местную горизонталь для некоторой средней точки.


\section{Схема первоначального построения и пересчёта пучка траекторий}

Тут про расчёты в текущем окне

это наверно завтра


\section{Математическая модель траекторного движения ВС}

Алгоритм использует следующее модельное
описание динамики самолёта:
\begin{eqnarray}
\dot x		 & = & v \cos{\varphi}, \nonumber \\
\dot z		 & = & v \sin{\varphi}, \nonumber \\
\dot \varphi & = & u / v,         \label{MainSyst4D} \\
\dot v		 & = & w.	\nonumber
\end{eqnarray}

\vspace{-2mm} \noindent
Здесь 
$x$, $z$~--- координаты положения на плоскости;
путевой угол $\varphi$~--- угол на плоскости между вектором скорости
от оси~$x$;
$v$~--- величина скорости ($v > 0$);
$u$~--- боковое ускорение;
$w$~--- продольное ускорение.

Предполагаем, что управления $u,w$ стеснены геометрическими ограничениями
$|u| \le u_{\mathrm{max}}$,  $|w| \le w_{\mathrm{max}}$.

При практическом использовании интегрирования с построением трека в геометрических
координатах используется сетка по времени, включающая все секундные отметки
(это позволяет корректно сравнивать треки с несовпадающими моментами переключения).

\subsection{Аналитические расчёты при интегрировании уравнений движения}

... непонял, какой вариант берём? (Федотов)


\section{Структура данных программы, термины}

{\em Участок постоянного управления}~--- промежуток времени, характеризующийся
постоянством ускорений ВС.
На нём фиксируются: $u_i$ (поле записи {\tt .Upr})~--- значение поперечного управления;
$w_i$ (поле {\tt .Wpr})~--- значение продольного управления;
$t_{n i}$ ({\tt .UTn})~--- время начала участка постоянного управления;
$t_{k i}$ ({\tt .UTk})~--- время конца участка постоянного управления.


{\em Трек управления} --- двунаправленный список участков постоянного управления.
Каждый участок постоянного управления в треке управления должен содержать
ссылки на предыдущий участок (поле записи {\tt .Prd}) 
и последующий участок (поле {\tt .Sld}).
Величины $t_{n i}$ и $t_{k i}$ последовательных элементов списка
должны быть согласованы, т.~е. $t_{k i-1}= t_{n i}$.
Также участки постоянного управления могут содержать поля {\tt .nTr} и 
{\tt .kTr}~---
ссылки на участок геометрического трека (определяется ниже),
который был порождён рассматриваемым участком постоянного управления.

{\em Замер РЛС} содержит поля:
{\tt .Xzr}~--- координата замера <<на cевер>> в плоскости Земли;
{\tt .Zzr}~--- координата замера <<на восток>> в плоскости Земли;
{\tt .Hzr}~--- высота замера над плоскостью Земли;
{\tt .Tzr}~--- время замера;
{\tt .Nrls}~--- номер РЛС замера.


{\em Трек замеров} --- двунаправленный список замеров РЛС.
Каждый замер РЛС в~треке замеров должен содержать
ссылки на предыдущий замер (поле записи {\tt .Prd}) 
и последующий замер (поле {\tt .Sld}).


{\em Точка геометрического трека} описывает положение ВС и содержит поля:
{\tt .X}~--- координата ВС <<на cевер>> в плоскости Земли;
{\tt .Z}~--- координата ВС <<на восток>> в плоскости Земли;
{\tt .H}~--- высота ВС над плоскостью Земли;
{\tt .Phi}~--- направление скорости ВС (угол по часовой стрелке относительно
направления на север);
{\tt .V}~--- величина скорости ВС.
Время точки геометрического трека в необходимых случаях
вычисляется используя её положение
в геометрическом треке.


{\em Геометрический трек} --- двунаправленный список точек геометрического трека.
Каждая точка геометрического трека должена содержать
ссылки на предыдущий замер (поле записи {\tt .Prd}) 
и последующий замер (поле {\tt .Sld}).
Вычисление геометрического трека по треку управления возможно при помощи
процедуры  {\tt PostrTrekaSTekUchUprPrymo()}. 
Аргументом этой процедуры является первый элемент списка трека управления,
этот элемент должен иметь поле {\tt .nTr}, указывающее на точку
геометрического трека.
Эта точка используются как начальная при интегрировании
уравнений движения ВС.


\section{Вычисление веса треков и меры расхождения треков}

Вес траектории используется для сравнения текущих треков
с целью отбора наилучшего при условии их "близости" (меры расхождения).
Вес трека характеризует апостериорную вероятность движения
по заданной совокупности замеров.
Численно мера расхождения треков рассчитывается
как среднее расстояние между треками в геометрических координатах,
рассчитываемое на равномерной сетке времени в текущем расчётном окне.




\section{Алгоритм оптимизации}

Алгоритм оптимизации основывается на методе Хука~-- Дживса [??].

В качестве входной информации алгоритм получает ссылку на трек управления
(последовательность участков постоянного управления).
% геометрический трек

Алгоритм варьирует:
значения продольного управления $w_i$,
значения поперечного управления $u_i$,
время переключения между участками постоянного управления $t_{n i}$.
При этом учитываются ограничения:
на абсолютные значения управления, 
на минимальную продолжительность постоянного управления.
Целью варьирования является построение последовательности
управлений, которые бы определяли геометрический трек 
с минимальным весом.

Для вычисления веса трека алгоритм формирует временный трек управления.
В~процессе формирования временного трека происходит проверка нарушения
ограничений на управление, если ограничения нарушаются, то происходит
возврат в основной алгоритм Хука~-- Дживса, при этом в качестве
значения минимизируемой функции возвращается штраф пропорциональный величине
нарушения ограничения (при этом при подаче на вход алгоритма
оптимизации трека управления с нарушением ограничений возможно <<скатывание>>
алгоритма в область, где ограничения не нарушаются).
Для построения геометрического трека по сформированному треку управления используется
обращение к процедуре {\tt PostrTrekaSTekUchUprPrymo()}
(которая производит интегрирование),
затем вес трека вычисляется обращением к функции
{\tt RaschetVesaTreka()} и происходит возврат в основной алгоритм
алгоритм Хука~-- Дживса с возвратом веса трека в качестве значения минимизируемой функции.


Варьирование прекращается когда текущие шаги варьирования
оказываются меньше заданных финальных шагов варьирования.

Алгоритм возвращает ссылку на новый трек управления, получившийся
в результате варьирования.
В свою очередь трек управления содержит ссылки на соответствующий геометрический трек.



\subsubsection{Константы-параметры алгоритма оптимизации}

Алгоритм использует следующие постоянные  параметры (константы):\\
{\tt Du1 = 0.5} -- начальный шаг варьирования поперечного управления;\\
{\tt Dw1 = 0.25} -- начальный шаг варьирования продольного управления;\\
{\tt Dt1 = 32.0} -- начальный шаг варьирования разбивки времени;\\
{\tt DuFin = 0.01} -- финальный шаг варьирования поперечного управления;\\
{\tt DwFin = 0.01} -- финальный шаг варьирования продольного управления;\\
{\tt DtFin = 0.02} -- финальный шаг варьирования разбивки времени;\\
{\tt MAXu = 4} ($u_{\mathrm{max}}$) -- максимальное значение поперечного управления;\\
{\tt MAXw = 2} ($w_{\mathrm{max}}$) -- максимальное значение продольного управления;\\
{\tt dtmin = 10.0} -- минимальный промежуток времени постоянного управления;\\
{\tt dh = 0.5} -- множитель уменьшения шага при неудаче в <<поиске вокруг базовой точки>> метода Хука~-- Дживса.





\section{Программа конвертации данных}

Программа {\tt tracks\_plots\_00} предназначена для фильтрации и конвертации данных 
(РЛС, АЗН-В, монорадарная обработка, мультирадарная обработка)
из текстовых файлов {\tt tracks.txt}, {\tt plots.txt}, {\tt plots\_ads.txt}, получаемых
при помощи программы {\tt vidparser.exe} из файлов {\tt .vid}.
Цель конвертации --- получить небольшие по объёму текстовые файлы данных
для использования в программе многогипотезного восстановления траектории.

В связи с тем, что исходные файлы имеют очень большой объём (гигабайты), полная загрузка информации
из файлов в оперативную память (при использовании 32-битной ОС и 32-битного компилятора)
не представляется возможной.
Используются неоднократное чтение файлов и приближённая оценка сверху количества замеров
в РЛС-треках.

%Алгоритм:
\subsubsection{Алгоритм}
\vspace{-3mm}
\begin{itemize}
\item Первое чтение файла {\tt tracks.txt}, сбор общей статистики по источникам, 
глобальным идентификаторам трека и т.п.
\item Выделение памяти для АЗН-треков.
\item Чтение файла {\tt plots\_ads.txt}. Заполнение массивов замеров АЗН.
\item Упорядочение замеров внутри АЗН-треков по времени, запись треков в файлы {\tt ads.new4} и {\tt ads.plt}.
\item Освобождение памяти для АЗН-треков.
\item Выделение памяти (на основе приближённой оценки) для  монорадарных треков (моно-треков),
треков мультирадарной обработки (мульти-треков), РЛС-треков.
\item Второе чтение файла {\tt tracks.txt}.
Заполнение массивов моно-треков и мульти-треков, 
заполнение номеров замеров в РЛС-треках.
\item Упорядочение замеров внутри моно-треков и мульти-треков по времени,
запись треков в файлы {\tt *\_mr.new4} и {\tt *\_mr.plt}.
\item Чтение файла {\tt plots.txt}. Заполнение массивов замеров РЛС-треков.
\item Упорядочение замеров внутри РЛС-треков по времени,
запись треков в файлы {\tt *\_r.new4} и {\tt *\_r.plt}.
\end{itemize}

\subsubsection{Особенности текущей версии, параметры программы}

Воздушные суда идентифицируются по параметру {\tt global} (глобальный номер трека),
при этом в обработку идёт не более {\tt AZN\_TRACKS\_MAX} воздушных судов, АЗН-треки которых
имеют не менее {\tt AZN\_TRACKS\_MIN\_MEASUR} замеров (при этом из подходящих
выбираются АЗН-треки с наибольшим числом замеров).

Из файлов {\tt tracks.txt}, {\tt plots.txt} учитываются РЛС-замеры и моно-замеры,
параметр {\tt sensor} которых равен параметру {\tt RADAR\_SENSOR\_ONLY}.

Если после всех фильтраций трек содержит меньше {\tt TRACKS\_MIN\_MEASUR} замеров,
то он не записывается.

Выходные файлы записываются в поддиректорию {\tt new}, которая не должна существовать 
до запуска программы.
В директории {\tt new} создаются поддиректории, совпадающие с параметром {\tt global}
записываемых ВС. 
Записываются файлы {\tt ads.new4} и {\tt ads.plt} (АЗН-треки), 
{\tt 240\_mr.new4} и {\tt 240\_mr.plt} (мульти-треки),
{\tt *\_mr.new4} и {\tt *\_mr.plt} (моно-треки),
{\tt *\_r.new4} и {\tt *\_r.plt} (РЛС-треки).
Здесь {\tt *} --- номер РЛС.

Файлы {\tt *.plt} имеют формат треков программы Ozi Explorer и используются
для визуализации треков при помощи программы GPSMapEdit.

\subsubsection{Формат файлов {\tt .new4}}

Текстовые файлы, в которых построчно записаны замеры.
Столбцы: время замера, широта замера, долгота замера, высота замера.
Столбцы разделяются символом табуляции.

Для РЛС-треков в качестве координат замеров используются поля {\tt lat} и {\tt lon}
файла {\tt plots.txt}, т.е. широта и долгота, 
сформированные из дальности и азимута сырых РЛС-замеров, 
которые предварительно корректируются с учётом текущей оценки систематических ошибок
в программе мультирадарной обработки.
